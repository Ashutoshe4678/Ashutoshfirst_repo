<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Railway Management System</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <style>
    body { font-family: Arial,sans-serif; background: #f8fafc; color:#222; margin: 0;}
    header { background:#4245a8;color:white;padding:12px 30px 8px 25px;}
    h1 { margin:0 0 8px 0;padding:0;font-size:1.8em;letter-spacing:2px;}
    nav button { background:#403baa; color:#fff; border:none; margin-right:15px; padding:7px 20px; font-size:1em; border-radius:3px; cursor:pointer;}
    nav button.selected { background: #dbeafe; color:#403baa; font-weight:bold;}
    nav {margin-bottom:12px;}
    main {max-width:620px;margin:22px auto 60px auto;background:white;border-radius:7px;box-shadow:0 2px 6px rgba(80,80,120,.09);}
    section { padding:24px;}
    .form-control {margin-bottom:10px;}
    label { display:block; margin-bottom:4px;}
    input, select {width:100%; padding:7px; border:1px solid #ddd; border-radius:3px;}
    table {width:100%; border-collapse:collapse; margin:16px 0;}
    th, td {border:1px solid #eee; padding:7px 2px;text-align:center;}
    th { background:#f1f5f9;}
    .btn-primary { background:#4245a8; color:white; border:none; padding:7px 22px; border-radius:3px;}
    .btn-danger { background:#ef4444; color:white; border:none; padding:5px 13px; border-radius:2px;}
    .status-cancelled { color: #ef4444; font-weight: bold; }
    .status-confirmed { color: #47a025; font-weight: bold;}
    #admin-panel { background:#f8fafc; border-radius:5px; border:1px solid #ccc;}
    .pnr-box { font-family:monospace;background:#f1f5f9;display:inline-block; padding:2px 7px;}
    @media (max-width:700px){
      main,section {padding:7px;}
      main {margin:0;}
    }
  </style>
</head>
<body>
  <header>
    <h1>Railway Management System</h1>
    <nav>
      <button id="btn-search" class="selected" onclick="showSection('search')">Search Trains</button>
      <button id="btn-mytickets" onclick="showSection('mytickets')">My Tickets</button>
      <button id="btn-pnr" onclick="showSection('pnr')">PNR Status</button>
      <button id="btn-admin" onclick="showSection('admin')">Admin Panel</button>
    </nav>
  </header>
  <main>
    <section id="section-search">
      <h2>Search Trains</h2>
      <form id="search-form" onsubmit="searchTrains(event)">
        <div class="form-control">
          <label>From Station</label>
          <input id="search-from" required maxlength="5" />
        </div>
        <div class="form-control">
          <label>To Station</label>
          <input id="search-to" required maxlength="5" />
        </div>
        <div class="form-control">
          <label>Journey Date</label>
          <input type="date" id="search-date" required />
        </div>
        <button class="btn-primary" type="submit">Find Trains</button>
      </form>
      <div id="search-results"></div>
    </section>
    <section id="section-mytickets" style="display:none">
      <h2>My Tickets</h2>
      <div id="mytickets-list"></div>
    </section>
    <section id="section-pnr" style="display:none">
      <h2>Check PNR Status</h2>
      <form id="pnr-form" onsubmit="lookupPNR(event)">
        <input id="pnr-input" placeholder="Enter PNR" maxlength="12" required />
        <button class="btn-primary" type="submit">Check</button>
      </form>
      <div id="pnr-display"></div>
    </section>
    <section id="section-admin" style="display:none">
      <h2>Admin Panel</h2>
      <div id="admin-panel"></div>
    </section>
  </main>
  <footer style="font-size:.99em;color:#444;text-align:center;margin:30px 0 8px 0">
    <hr style="margin:18px 0;">
    <span>Railway Management System Project. Demo only.
    </span>
  </footer>
  <script>
    // Sample train data
    let trains = [
      { number:"12001", name:"Delhi-Mumbai Shatabdi", from:"DEL", to:"BOM", dep:"07:20", arr:"17:30", fare: 1380, seats: {SL:60,AC:25,2S:40} },
      { number:"12426", name:"Kerala Express", from:"NDLS", to:"ERS", dep:"11:10", arr:"16:55", fare:2120, seats: {SL:80,AC:40,2S:80} },
      { number:"12617", name:"Mangala SF Express", from:"NZM", to:"MAQ", dep:"09:15", arr:"16:40", fare:1890, seats: {SL:45,AC:23,2S:55} }
    ];

    // List of bookings in session
    let bookings = [];
    let bookingCount = 0;

    //--- UI Logic ---
    function showSection(section) {
      ["search","mytickets","pnr","admin"].forEach(s=> {
        document.getElementById(`section-${s}`).style.display = (s===section) ? "" : "none";
        document.getElementById(`btn-${s}`).classList.toggle("selected", s===section);
      });
      if (section==="mytickets") renderMyTickets();
      if (section==="admin") renderAdminPanel();
      if (section==="search") document.getElementById("search-results").innerHTML="";
      if (section==="pnr") document.getElementById("pnr-display").innerHTML="";
    }

    //--- Train Search + Book Logic ---
    function searchTrains(e){
      e.preventDefault();
      const from = document.getElementById("search-from").value.toUpperCase();
      const to = document.getElementById("search-to").value.toUpperCase();
      const date = document.getElementById("search-date").value;
      let html = "";
      const found = trains.filter(t =>
        t.from===from && t.to===to && t.seats && Object.values(t.seats).some(s=>s>0)
      );
      if (found.length===0) {
        html = "<p>No trains found for the selected route/date.</p>";
      } else {
        html += `<table>
                  <tr><th>No.</th><th>Train Name</th><th>From</th><th>To</th><th>Dep</th><th>Arr</th><th>SL</th><th>AC</th><th>2S</th><th>Book</th></tr>`;
        found.forEach(tr=>{
          html += `<tr>
            <td>${tr.number}</td>
            <td>${tr.name}</td>
            <td>${tr.from}</td>
            <td>${tr.to}</td>
            <td>${tr.dep}</td>
            <td>${tr.arr}</td>
            <td>${tr.seats.SL}</td>
            <td>${tr.seats.AC}</td>
            <td>${tr.seats.2S}</td>
            <td>
              <button class="btn-primary" onclick="showBookingForm('${tr.number}','${date}')">Book</button>
            </td>
          </tr>`;
        });
        html += "</table>";
      }
      document.getElementById("search-results").innerHTML = html;
    }

    function showBookingForm(trainNumber, date){
      const t = trains.find(trg=>trg.number===trainNumber);
      let classOptions = Object.keys(t.seats).map(cls=>
            `<option value="${cls}">${cls} (${t.seats[cls]} seats)</option>`).join("");
      document.getElementById("search-results").innerHTML =
        `<h3>Book Ticket for ${t.name} (${t.number})</h3>
         <form id="book-form" onsubmit="doBooking(event,'${trainNumber}','${date}')">
           <label>Passenger Name</label>
           <input name="pname" required maxlength="30"/><br/>
           <label>Age</label>
           <input name="age" type="number" min="0" max="120" required style="width:60px"/><br/>
           <label>Gender</label>
           <select name="gender"><option>Male</option><option>Female</option><option>Other</option></select><br/>
           <label>Class</label>
           <select name="cls">${classOptions}</select><br/>
           <button class="btn-primary" type="submit">Book Ticket</button>
           <button onclick="showSection('search');return false;">Back</button>
         </form>`;
    }

    function doBooking(e,trainNumber,date){
      e.preventDefault();
      const form = e.target;
      const t = trains.find(trg=>trg.number===trainNumber);
      const pname = form.pname.value.trim();
      const age = form.age.value;
      const gender = form.gender.value;
      const cls = form.cls.value;
      // Check seat availability
      if (!t || t.seats[cls] <= 0) {
        alert("Sorry, seat not available anymore.");
        showSection('search');
        return;
      }
      // Reserve seat
      t.seats[cls]--;
      // Generate PNR and create booking
      const pnr = ("" + Date.now() + Math.floor(Math.random()*1000)).slice(-10);
      const booking = {
        pnr, trainNumber, passenger: pname, age, gender, cls, date, status: "Confirmed",
        trainName: t.name, from: t.from, to: t.to, dep: t.dep, arr: t.arr, fare: t.fare,
      };
      bookings.push(booking);
      alert(`Booking confirmed! PNR: ${pnr}`);
      showSection('mytickets');
      renderMyTickets();
    }

    //--- My Tickets and Cancellation ---
    function renderMyTickets(){
      if (bookings.length===0) {
        document.getElementById('mytickets-list').innerHTML = "<i>No tickets booked.</i>";
        return;
      }
      let html = `<table>
                    <tr><th>PNR</th><th>Train</th><th>Date</th><th>Name</th><th>Class</th><th>Status</th><th></th></tr>`;
      bookings.forEach(b=>{
        html += `<tr>
          <td><span class="pnr-box">${b.pnr}</span></td>
          <td>${b.trainNumber} (${b.trainName})</td>
          <td>${b.date}</td>
          <td>${b.passenger}</td>
          <td>${b.cls}</td>
          <td class="status-${b.status.toLowerCase()}">${b.status}</td>
          <td>${
            b.status==="Confirmed"
            ? `<button class="btn-danger" onclick="cancelTicket('${b.pnr}')">Cancel</button>`
            : ""
          }</td>
        </tr>`;
      });
      html += "</table>";
      document.getElementById('mytickets-list').innerHTML = html;
    }

    function cancelTicket(pnr){
      const i = bookings.findIndex(b=>b.pnr===pnr);
      if (i!==-1 && bookings[i].status==="Confirmed") {
        bookings[i].status = "Cancelled";
        // Add seat back
        const t=trains.find(t=>t.number===bookings[i].trainNumber);
        if(t) t.seats[bookings[i].cls]++;
        alert("Ticket cancelled!");
        renderMyTickets();
      }
    }

    //--- PNR Lookup ---
    function lookupPNR(ev){
      ev.preventDefault();
      const pnr = document.getElementById("pnr-input").value.trim();
      const booking = bookings.find(b=>b.pnr===pnr);
      if (!booking) {
        document.getElementById("pnr-display").innerHTML = `<p>Booking not found!</p>`;
        return;
      }
      document.getElementById("pnr-display").innerHTML =
        `<b>Status:</b> <span class="status-${booking.status.toLowerCase()}">${booking.status}</span><br>
         <b>Name:</b> ${booking.passenger}, <b>Class:</b> ${booking.cls}, <b>Date:</b> ${booking.date}<br>
         <b>Train:</b> ${booking.trainNumber} | ${booking.trainName}<br>
         <b>From:</b> ${booking.from} (${booking.dep}) <b>To:</b> ${booking.to} (${booking.arr})<br>
         <b>PNR:</b> <span class="pnr-box">${booking.pnr}</span>`;
    }

    //--- Admin Panel ---
    function renderAdminPanel(){
      let html = `<h4>Train List</h4>
        <table><tr><th>No.</th><th>Name</th><th>From</th><th>To</th>
        <th>SL</th><th>AC</th><th>2S</th><th>Fare</th><th></th></tr>`;
      trains.forEach((t,ix)=>{
        html += `<tr>
          <td>${t.number}</td>
          <td>${t.name}</td>
          <td>${t.from}</td>
          <td>${t.to}</td>
          <td>${t.seats.SL}</td>
          <td>${t.seats.AC}</td>
          <td>${t.seats.2S}</td>
          <td>&#8377;${t.fare}</td>
          <td>
            <button class="btn-danger" onclick="deleteTrain(${ix})">Delete</button>
          </td>
        </tr>`;
      });
      html += "</table><h4>Add Train</h4>";
      html += `<form onsubmit="addTrain(event)">
                <input placeholder="Number" name="number" maxlength="8" required style="width:70px">
                <input placeholder="Name" name="name" maxlength="35" required>
                <input placeholder="From" name="from" maxlength="5" required style="width:70px">
                <input placeholder="To" name="to" maxlength="5" required style="width:70px"><br>
                <input placeholder="Departure" name="dep" required style="width:80px" type="time">
                <input placeholder="Arrival" name="arr" required style="width:80px" type="time">
                <input placeholder="SL seats" name="sSL" type="number" required min="10" style="width:80px">
                <input placeholder="AC seats" name="sAC" type="number" required min="5" style="width:80px">
                <input placeholder="2S seats" name="s2S" type="number" required min="5" style="width:80px">
                <input placeholder="Fare" name="fare" type="number" required min="50" style="width:80px">
                <button type="submit" class="btn-primary">Add Train</button>
              </form>`;
      document.getElementById("admin-panel").innerHTML = html;
    }

    function addTrain(e){
      e.preventDefault();
      const f = e.target;
      const newTrain = {
        number: f.number.value.trim(),
        name: f.name.value.trim(),
        from: f.from.value.trim().toUpperCase(),
        to: f.to.value.trim().toUpperCase(),
        dep: f.dep.value,
        arr: f.arr.value,
        fare: parseInt(f.fare.value),
        seats: {
          SL:parseInt(f.sSL.value),
          AC:parseInt(f.sAC.value),
          2S:parseInt(f.s2S.value),
        }
      };
      trains.push(newTrain);
      alert("Train added!");
      renderAdminPanel();
    }

    function deleteTrain(ix){
      if (confirm("Are you sure you want to delete this train?")) {
        trains.splice(ix,1);
        renderAdminPanel();
      }
    }

  </script>
</body>
</html>
